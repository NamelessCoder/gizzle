<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Gizzle by NamelessCoder</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Gizzle</h1>
        <p>Light-weight PHP Github web hook with plugin API</p>
        <p class="view"><a href="https://github.com/NamelessCoder/gizzle">View the Project on GitHub <small>NamelessCoder/gizzle</small></a></p>
        <ul>
          <li><a href="https://github.com/NamelessCoder/gizzle/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/NamelessCoder/gizzle/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/NamelessCoder/gizzle">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="gizzle" class="anchor" href="#gizzle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gizzle</h1>

<p><a href="https://jenkins.fluidtypo3.org/job/gizzle"><img src="https://img.shields.io/travis/NamelessCoder/gizzle.svg?style=flat-square" alt="Build Status"></a> <a href="https://coveralls.io/r/NamelessCoder/gizzle"><img src="https://img.shields.io/coveralls/NamelessCoder/gizzle.svg?style=flat-square" alt="Coverage Status"></a> <a href="https://packagist.org/packages/namelesscoder/gizzle"><img src="https://img.shields.io/packagist/v/NamelessCoder/gizzle.svg?style=flat-square" alt="Latest Stable Version"></a> <a href="https://packagist.org/packages/namelesscoder/gizzle"><img src="https://img.shields.io/packagist/dt/NamelessCoder/gizzle.svg?style=flat-square" alt="Total Downloads"></a></p>

<p>A tiny GitHub Webhook Listener written in PHP which can be easily extended with plugins.</p>

<h2>
<a id="installing-gizzle" class="anchor" href="#installing-gizzle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installing Gizzle</h2>

<p>Run:</p>

<div class="highlight highlight-bash"><pre>composer require namelesscoder/gizzle</pre></div>

<p>Assuming your project uses the composer class loader you then have access to using Gizzle's classes in your project.</p>

<h3>
<a id="virtual-host" class="anchor" href="#virtual-host" aria-hidden="true"><span class="octicon octicon-link"></span></a>Virtual Host</h3>

<p>If you wish to use the default receiving script, symlink the <code>web</code> folder from Gizzle:</p>

<div class="highlight highlight-bash"><pre>ln -s vendor/namelesscoder/gizzle/web</pre></div>

<p>And add a (publicly accessible!) virtual host for your favorite HTTP server pointing to <code>./web/</code> inside this folder or simply include the package in your own composer application.</p>

<p>Finally, configure your GitHub repository and add the URL to your Gizzle project pointing to the file <code>/github-webhook.php</code> as requested through HTTP (file <code>web/github-webhook.php</code> in filesystem) or configure your virtual host to serve the <code>github-webhook.php</code> filename as default file.</p>

<p>You can of course create your own receiving script instead of <code>github-webhook.php</code> if you need additional features.</p>

<blockquote>
<p>Note! the default receiving script only supports the features described in this README file.</p>
</blockquote>

<h3>
<a id="security-secret-file-and-personal-token" class="anchor" href="#security-secret-file-and-personal-token" aria-hidden="true"><span class="octicon octicon-link"></span></a>Security (secret file and personal token)</h3>

<p>Gizzle uses the <code>secret</code> (a token) which you enter in GitHub while setting up the web hook. Use the same secret token when initializing your Payload class. The secret token is required and must match, or the Payload throws a RuntimeException.</p>

<p><strong>When using the shipped public file in <code>./web/github-webhook.php</code> your secret token will be read from the file <code>./.secret</code></strong> (note: dot-file, placed outside the public web root). When first installing this package or your own package which uses this package, create the file whichever way you prefer and make sure it contains your "secret" key from GitHub. For example, using the shell:</p>

<div class="highlight highlight-bash"><pre><span class="pl-s3">echo</span> <span class="pl-s1"><span class="pl-pds">"</span>mysupersecretkey<span class="pl-pds">"</span></span> <span class="pl-k">&gt;</span> .secret</pre></div>

<p>Gizzle can also use a personal access token to "talk back" to GitHub. You can utilize this to do things like comment on the commit and update it with a status (which is displayed when the commit is part of a pull request) - and even automatically merge branches. The default implementation for every plugin will <em>automatically update the commit status with pending, success or error as the Payload execution progresses</em>, but other plugins can access the GitHub API from Gizzle plugins. All you have to do is make sure a special <code>.token</code> file exists and contains your personal access token - which, like the <code>.secret</code> file - is sensitive information you should never share. The <code>.token</code> file is created the exact same way as the <code>.secret</code> file and you can obtain a new access token to use just with Gizzle. <a href="#updating-commit-status">Read more about how in the section about the GitHub API integration</a>.</p>

<h2>
<a id="running-gizzle" class="anchor" href="#running-gizzle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running Gizzle</h2>

<p>The <code>./web/github-webhook.php</code> file which is shipped with this repository can be used as URL of your web hook when configuring it in GitHub - or you can manually process the payload from within your own application and use its URL instead:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$data</span> <span class="pl-k">=</span> <span class="pl-s3">file_get_contents</span>(<span class="pl-s1"><span class="pl-pds">'</span>php://input<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2"><span class="pl-vo">$secret</span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>mysecret<span class="pl-pds">'</span></span>;</span>
<span class="pl-s2"><span class="pl-vo">$gizzle</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">\NamelessCoder\Gizzle\</span><span class="pl-s3">Payload</span>(<span class="pl-vo">$data</span>, <span class="pl-vo">$secret</span>);</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-c">// Plugins are then loaded from the packages used in, and in the order of, file `settings/Settings.yml` (see below)</span></span>
<span class="pl-s2"><span class="pl-c">// * alternative loading 1: $gizzle-&gt;loadPlugins('MyVendor\\MyPackage');</span></span>
<span class="pl-s2"><span class="pl-c">// * alternative loading 2: $gizzle-&gt;loadPlugins($arrayOfPackageNames);</span></span>
<span class="pl-s2"><span class="pl-c">// * alternative loading 3: $gizzle-&gt;loadPlugins($package1, $package2, $package3);</span></span>
<span class="pl-s2"><span class="pl-c">// using either alternative causes the all plugins returned by the PluginList to be ran. Settings are still applied</span></span>
<span class="pl-s2"><span class="pl-c">// but not used for determining plugins to run and in which order, as it is when running a settings file.</span></span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-c">/** @var \NamelessCoder\Gizzle\Response $response */</span></span>
<span class="pl-s2"><span class="pl-vo">$response</span> <span class="pl-k">=</span> <span class="pl-vo">$gizzle</span><span class="pl-k">-&gt;</span>process();</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-c">/** @var integer $code */</span></span>
<span class="pl-s2"><span class="pl-vo">$code</span> <span class="pl-k">=</span> <span class="pl-vo">$response</span><span class="pl-k">-&gt;</span>getCode();</span>
<span class="pl-s2"><span class="pl-c">// code &gt;0 indicates errors are present; value indicates exact error. Code =0 means no errors.</span></span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-c">/** @var \RuntimeException[] $errors */</span></span>
<span class="pl-s2"><span class="pl-vo">$errors</span> <span class="pl-k">=</span> <span class="pl-vo">$response</span><span class="pl-k">-&gt;</span>getErrors();</span></pre></div>

<h2>
<a id="configuring-plugins" class="anchor" href="#configuring-plugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring plugins</h2>

<p>Not all plugins support configuration but those that do can be configured by placing a <code>Settings.yml</code> file in the root of your project or in any folder leading up to the file which creates the Payload instance. The first file found in a reverse search gets used and should contain all the configuration required by your plugins.</p>

<p>The format of the configuration file is:</p>

<div class="highlight highlight-yaml"><pre><span class="pl-ent">Vendor\PackageName</span>:
  <span class="pl-ent">Vendor\PackageName\GizzlePlugins\OnePlugin</span>:
    <span class="pl-s1"><span class="pl-ent">enabled:</span> <span class="pl-s1">true</span></span>
  <span class="pl-ent">AnotherVendor\AnotherPackageName\GizzlePlugins\OtherPlugin</span>:
    <span class="pl-s1"><span class="pl-ent">enabled:</span> <span class="pl-s1">true</span></span>
<span class="pl-ent">OtherVendor\ThirdPackage</span>:
  <span class="pl-ent">OtherVendor\ThirdPackage\GizzlePlugins\ThirdPlugin</span>:
    <span class="pl-s1"><span class="pl-ent">enabled:</span> <span class="pl-s1">true</span></span></pre></div>

<p>It is possible for any Package to return Plugins from other packages as well - which is ideal when constructing Packages which include and provide configuration for many plugins. Such a package might return plugin names which <strong>don't belong to that Package</strong>, and because the class name is used as key in the configuration, <strong>it is possible to configure the same Plugin differently when it is provided by Package A and Package B.</strong> This is done to increase reusability of smaller plugins which can serve many purposes - a good example would be a Git plugin which pushes when used in one package and pulls when used in another, because each package can provide a different configuration for the same plugin.</p>

<p>Word of caution, though: the plugin can <strong>only</strong> be configured inside the scope of the Package that returned it. This means that <strong>every</strong> mandatory option should be present in each place the Plugin is used (in other words: you cannot configure global defaults).</p>

<h3>
<a id="plugin-events" class="anchor" href="#plugin-events" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plugin events</h3>

<p>Gizzle provides you with a way to configure for each plugin, a list of other plugins which should be executed with the same payload on special events. Currently supported is the <code>onStart</code>, <code>onSuccess</code> and <code>onError</code> events. There are two ways of configuring events; one is from inside your custom plugin classes by providing a default value for the corresponding setting (you can do so in the <code>initialize()</code> or <code>getSetting</code> methods whichever you prefer) - the other way is defining these settings in your configuration file. If providing these as a default setting value from your custom plugin simply return the exact same array that is expressed for each event in this example.</p>

<p>About the example: the illustration configures the self-update plugin which runs <code>git pull</code> and <code>composer install</code> in the root folder of the package that implemented it in its configuration. The sub-plugin that's also used is <em>a ficticious plugin which sends an email to the entity pushing the commit described in the payload with cc: or bcc: defined by settings for that plugin</em> and another <em>also ficticious plugin which is able to send a message to <code>syslog</code> with a custom severity</em>. It also demonstrates how you can use this in as many nested levels as you wish, catching events at each level; in this case causing the "CRITICAL!" syslog message if self-update failed and either the pusher or the master dev-op could not be notified of the failure directly.</p>

<div class="highlight highlight-yaml"><pre><span class="pl-ent">MyVendor\MyGizzleImplementingPackage</span>:
  <span class="pl-ent">NamelessCoder\Gizzle\GizzlePlugins\SelfUpdatePlugin</span>:
    <span class="pl-s1"><span class="pl-ent">onStart:</span><span class="pl-s1"></span></span>
      <span class="pl-c"># send a copy to pusher only, informing that self-update began</span>
      <span class="pl-ent">OtherVendor\GizzleEmailPlugins\GizzlePlugins\EmailPusherPlugin</span>:
        <span class="pl-s1"><span class="pl-ent">subject:</span> <span class="pl-s1">Starting self-update of MyGizzleImplementingPackage</span></span>
    <span class="pl-s1"><span class="pl-ent">onError:</span><span class="pl-s1"></span></span>
      <span class="pl-c"># send a copy to pusher and bcc an address that won't be disclosed to pusher</span>
      <span class="pl-ent">OtherVendor\GizzleEmailPlugins\GizzlePlugins\EmailPusherPlugin</span>:
        <span class="pl-s1"><span class="pl-ent">subject:</span> <span class="pl-s1">Your team updated a service</span></span>, please validate the result.
        <span class="pl-s1"><span class="pl-ent">bcc:</span> <span class="pl-s1">master-devops@organization.foo</span></span>
        <span class="pl-s1"><span class="pl-ent">onError:</span><span class="pl-s1"></span></span>
          <span class="pl-ent">OtherVendor\MonitoringPlugins\GizzlePlugins\LogPlugin</span>:
            <span class="pl-s1"><span class="pl-ent">message:</span> <span class="pl-s1">CRITICAL ERROR! Man all battle stations</span></span>, the server can<span class="pl-s1"><span class="pl-pds">'</span>t send mail!</span>
<span class="pl-s1">            severity: fatal</span>
<span class="pl-s1">    onSuccess:</span>
<span class="pl-s1">      # send a copy to pusher with cc to all developers</span>
<span class="pl-s1">      OtherVendor<span class="pl-cce">\G</span>izzleEmailPlugins<span class="pl-cce">\G</span>izzlePlugins<span class="pl-cce">\E</span>mailPusherPlugin:</span>
<span class="pl-s1">        subject: MyGizzleImplementingPackage was updated!</span>
<span class="pl-s1">        cc: developers@organization.foo</span></pre></div>

<p>Note that these events are <em>defined on the same level as any other setting a plugin uses</em> which means the names are reserved and cannot be used as names for your own plugin settings. Defining an incorrect value (something not an array) may cause exceptions. However: contrary to how "root" plugins report errors, exceptions which are raised by a plugin that is used as event listener <em>will simply add a friendly error message to the response, allowing the next plugin to continue</em>, and so on. Whereas a "root" plugin would cause the entire Payload to stop processing.</p>

<h3>
<a id="multiple-configurations" class="anchor" href="#multiple-configurations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multiple configurations</h3>

<p>You can create any number of alternative configuration files. The name or path of the settings file can be provided manually when instanciating the Payload:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$settingsFile</span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>Settings/SpecialSettings.yml<span class="pl-pds">'</span></span>;</span>
<span class="pl-s2"><span class="pl-vo">$payload</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-s3">Payload</span>(<span class="pl-vo">$data</span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>{}<span class="pl-pds">'</span></span>, <span class="pl-vo">$secret</span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, <span class="pl-vo">$settingsFile</span>);</span></pre></div>

<p>You can then place any number of such additional settings files as <code>./Settings/*.yml</code> and reference them by changing the third parameter.</p>

<p>The default implementation that ships with Gizzle - the <code>github-webhook.php</code> file inside <code>./web/</code> - uses the <code>$_GET['settings']</code> argument as third parameter after validating that it contains the only allowed characters: <code>a-z</code>, <code>A-Z</code>, <code>0-9</code> and <code>/</code>. The latter is allowed in order to let you divide configuration files into any number of sub directories and reference them by path. Additionally, the file name itself must end with <code>.yml</code>, must not be a hidden file (dot-file) and finally must be a relative path (e.g. not starting with <code>/</code>).</p>

<p>To select which configuration gets used simply set the expected GET parameter when adding the URL as webhook in GitHub's repository settings:</p>

<pre><code>http://mydomain.foo/github-webhook.php?settings=Settings/SpecialSettings.yml
</code></pre>

<p>And you can specify multiple settings files which must all be processed by specifying arguments as an array:</p>

<pre><code>http://mydomain.foo/github-webhook.php?settings[]=Settings/SpecialSettings.yml&amp;settings[]=Settings/OtherSettings.yml
</code></pre>

<p>Which causes first <code>./Settings/SpecialSettings.yml</code> and then <code>./Settings/OtherSettings.yml</code> to be processed in the same execution. Any error caused by one will cause the job to exit, throwing only the first error which occurred.</p>

<p>You can also use this to version your settings. If for example your design practices change and you require support for more than one repository design pattern, you can easily store the legacy configuration as a different settings file and by modifying the web hook URL in each repository, support both of your repositories' patterns simultaneously. A good example of when such versioning might become necessary is when switching to/from the "git flow" pattern or in multiple production branch scenarios where new production branches are continuously added and removed.</p>

<h2>
<a id="usage-of-api-from-plugins" class="anchor" href="#usage-of-api-from-plugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage of API from plugins</h2>

<p>The API can be accessed via the <code>$payload</code> argument that is provided to the essential methods on plugins. To access the API:</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-vo">$api</span> <span class="pl-k">=</span> <span class="pl-vo">$payload</span><span class="pl-k">-&gt;</span>getApi();</span>
<span class="pl-s2"><span class="pl-k">if</span> (<span class="pl-c1">TRUE</span> <span class="pl-k">===</span> <span class="pl-s3">empty</span>(<span class="pl-vo">$api</span><span class="pl-k">-&gt;</span>getToken()) {</span>
<span class="pl-s2">    <span class="pl-c">// avoid doing anything with the API when there is</span></span>
<span class="pl-s2">    <span class="pl-c">// no token loaded; UNLESS you are able to provide</span></span>
<span class="pl-s2">    <span class="pl-c">// your own token from inside the plugin code.</span></span>
<span class="pl-s2">} <span class="pl-k">else</span> {</span>
<span class="pl-s2">    <span class="pl-vo">$response</span> <span class="pl-k">=</span> <span class="pl-vo">$api</span><span class="pl-k">-&gt;</span>get(<span class="pl-s1"><span class="pl-pds">'</span>/emoji<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2">    <span class="pl-vo">$emojis</span> <span class="pl-k">=</span> <span class="pl-vo">$api</span><span class="pl-k">-&gt;</span>decode(<span class="pl-vo">$response</span>);</span>
<span class="pl-s2">}</span></pre></div>

<p>Every resource type in Github has its own URL and some resource types support different parameters depending on the context - for example, a Github "comment" can be created in several different contexts and each has requirements for required properties. Study the <a href="https://developer.github.com/v3/">Github API v3 developer documentation</a> for the details about each resource.</p>

<p>Note the additional decoding step which is required when you need to read data from the response. An <code>stdClass</code> is returned with public properties allowing you to read response data - see the official GitHub v3 API reference for available data for each action. If you need another data type, manually use <code>json_decode($response-&gt;getContent());</code> and pass any special <code>JSON_*</code> options you require.</p>

<blockquote>
<p>Tip: If the API returns data which contains for example commits, repositories, entities etc. and the data type is <code>array</code>, Gizzle's domain model supports mapping such data (recursively) by simply passing the array of properties into the constructor: <code>$commit = new Commit($commitDataAsArray);</code>.</p>
</blockquote>

<h3>
<a id="updating-commit-status" class="anchor" href="#updating-commit-status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating commit status</h3>

<p>If you wish to make Gizzle update the HEAD commit of the Payload as it gets processed (one status per settings file that processes the Payload), Gizzle supports a GitHub personal access token which, like the <code>.secret</code> file, is placed in the project root folder and is named <code>.token</code>. A token is a 32-character string with randomized letters and numbers.</p>

<p>To obtain a personal access token:</p>

<ol>
<li>In GitHub, under account settings, <a href="https://github.com/settings/applications#personal-access-tokens">generate yourself a new Access Token</a>.</li>
<li>Make sure you associate this token with at least permissions to access status and access (public) repositories. If any plugins require additional permissions, each should document which - and you should add permissions as required.</li>
<li>Copy the token and insert it in the file <code>.token</code> in the project root folder.</li>
<li>Do not commit the token file! Instead, add it to git ignore either locally or for your project. The token is <strong>sensitive information</strong> and should never be shared.</li>
</ol>

<p>When present, the token is read from this file and used to initialize the <a href="https://github.com/milo/github-api">GitHub API used by Gizzle</a>. The API can then be used by Gizzle and Gizzle plugins to perform any action which you permit.</p>

<p>Additional resources for using the Github API:</p>

<ul>
<li><a href="https://github.com/settings/applications#personal-access-tokens">Access Token generation in GitHub account</a></li>
<li><a href="https://developer.github.com/v3/">Documentation for every possible action you can perform through this GitHub API</a></li>
<li><a href="https://github.com/milo/github-api/wiki">Documentation for how to use the PHP <code>Api</code> class to access the GitHub API</a></li>
</ul>

<h2>
<a id="creating-plugins" class="anchor" href="#creating-plugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating plugins</h2>

<p>To create a plugin for Gizzle you need one mandatory class and optionally a lister class (which gets shared by all plugins in your package):</p>

<ol>
<li>The class <code>MyVendor\MyPackage\GizzlePlugins\MyAwesomePlugin</code> (or another class name or namespace location - your choice) which implements <code>NamelessCoder\Gizzle\PluginInterface</code> and the methods it specifies.</li>
<li>Optionally also the class <code>MyVendor\MyPackage\GizzlePlugins\PluginList</code> which must implement interface <code>NamelessCoder\Gizzle\PluginListInterface</code> and contain a <code>getPluginClassNames</code> method which returns an array of any number of string class names of your plugins. This class gets used when users reference your plugin collection using your package name - it is not required if your plugins are solely intended to be used from a <code>Settings.yml</code> context (as described above).</li>
</ol>

<p>When users load your plugins by package name, your PluginList class is asked to return the class names of plugins and it is here you have your option to change which class names are returned for example depending on configuration. However, when users implement your plugin directly in <code>Settings.yml</code> or by manually instanciating it, your PluginList class does not get used. This means that <em>if your plugin only should be used directly from settings or manually inside other plugins, you do not need the PluginList class - which is why it is marked optional</em>.</p>

<h3>
<a id="example-plugin" class="anchor" href="#example-plugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example plugin</h3>

<div class="highlight highlight-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-k">namespace</span> <span class="pl-en">NamelessCoder\Gizzle\GizzlePlugins</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">NamelessCoder\Gizzle\PluginInterface</span>;</span>
<span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">NamelessCoder\Gizzle\AbstractPlugin</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c"> * Example Gizzle Plugin</span></span>
<span class="pl-s2"><span class="pl-c"> *</span></span>
<span class="pl-s2"><span class="pl-c"> * Sends an email to the person who pushed the commit,</span></span>
<span class="pl-s2"><span class="pl-c"> * but only if the commit was made to the "demo" branch.</span></span>
<span class="pl-s2"><span class="pl-c"> */</span></span>
<span class="pl-s2"><span class="pl-st">class</span> <span class="pl-en">ExamplePlugin</span> <span class="pl-s">extends</span> <span class="pl-e">AbstractPlugin</span> <span class="pl-s">implements</span> <span class="pl-e">PluginInterface</span> {</span>
<span class="pl-s2"></span>
<span class="pl-s2">    <span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">     * Returns TRUE to trigger this Plugin if branch</span></span>
<span class="pl-s2"><span class="pl-c">     * is "demo", as determined by REF of Payload.</span></span>
<span class="pl-s2"><span class="pl-c">     *</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@param</span> Payload $payload</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@return</span> boolean</span></span>
<span class="pl-s2"><span class="pl-c">     */</span></span>
<span class="pl-s2">    <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">trigger</span>(<span class="pl-s3">Payload</span> <span class="pl-vo">$payload</span>) {</span>
<span class="pl-s2">        <span class="pl-k">return</span> <span class="pl-s1"><span class="pl-pds">'</span>refs/heads/demo<span class="pl-pds">'</span></span> <span class="pl-k">===</span> <span class="pl-vo">$payload</span><span class="pl-k">-&gt;</span>getRef();</span>
<span class="pl-s2">    }</span>
<span class="pl-s2"></span>
<span class="pl-s2">    <span class="pl-c">/**</span></span>
<span class="pl-s2"><span class="pl-c">     * Send a thank you email to commit pusher.</span></span>
<span class="pl-s2"><span class="pl-c">     *</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@param</span> Payload $payload</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s2"><span class="pl-c">     * <span class="pl-k">@throws</span> \RuntimeException</span></span>
<span class="pl-s2"><span class="pl-c">     */</span></span>
<span class="pl-s2">    <span class="pl-s">public</span> <span class="pl-st">function</span> <span class="pl-en">process</span>(<span class="pl-s3">Payload</span> <span class="pl-vo">$payload</span>) {</span>
<span class="pl-s2">        <span class="pl-vo">$pusherEmail</span> <span class="pl-k">=</span> <span class="pl-vo">$payload</span><span class="pl-k">-&gt;</span>getPusher()<span class="pl-k">-&gt;</span>getEmail();</span>
<span class="pl-s2">        <span class="pl-vo">$body</span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>A big thank you from <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-vo">$payload</span><span class="pl-k">-&gt;</span>getRepository()<span class="pl-k">-&gt;</span>getOwner()<span class="pl-k">-&gt;</span>getName();</span>
<span class="pl-s2">        <span class="pl-vo">$mailed</span> <span class="pl-k">=</span> <span class="pl-s3">mail</span>(<span class="pl-vo">$pusherEmail</span>, <span class="pl-s1"><span class="pl-pds">'</span>Thank you for contributing!<span class="pl-pds">'</span></span>, <span class="pl-vo">$body</span>);</span>
<span class="pl-s2">        <span class="pl-k">if</span> (<span class="pl-c1">FALSE</span> <span class="pl-k">===</span> <span class="pl-vo">$mailed</span>) {</span>
<span class="pl-s2">            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-s3">\RuntimeException</span>(<span class="pl-s1"><span class="pl-pds">'</span>Could not email the kind contributor at <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-vo">$pusherEmail</span>);</span>
<span class="pl-s2">        }</span>
<span class="pl-s2">    }</span>
<span class="pl-s2"></span>
<span class="pl-s2">}</span></pre></div>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/NamelessCoder">NamelessCoder</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-9519094-6");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>